<!DOCTYPE html>
    <html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>Lab8 - 范围搜索实验</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css" integrity="sha384-D+9gmBxUQogRLqvARvNLmA9hS2x//eK1FhVb9PiU86gmcrBrJAQT8okdJ4LMp2uv" crossorigin="anonymous">
        <style>
/*--------------------------------------------------------------------------------------------- * Copyright (c) Microsoft Corporation. All rights reserved. * Licensed under the MIT License. See License.txt in the project root for license information. *--------------------------------------------------------------------------------------------*/ body { font-family: "Segoe WPC", "Segoe UI", "SFUIText-Light", "HelveticaNeue-Light", sans-serif, "Droid Sans Fallback"; font-size: 14px; padding: 0 26px; line-height: 22px; word-wrap: break-word; } #code-csp-warning { position: fixed; top: 0; right: 0; color: white; margin: 16px; text-align: center; font-size: 12px; font-family: sans-serif; background-color:#444444; cursor: pointer; padding: 6px; box-shadow: 1px 1px 1px rgba(0,0,0,.25); } #code-csp-warning:hover { text-decoration: none; background-color:#007acc; box-shadow: 2px 2px 2px rgba(0,0,0,.25); } body.scrollBeyondLastLine { margin-bottom: calc(100vh - 22px); } body.showEditorSelection .code-line { position: relative; } body.showEditorSelection .code-active-line:before, body.showEditorSelection .code-line:hover:before { content: ""; display: block; position: absolute; top: 0; left: -12px; height: 100%; } body.showEditorSelection li.code-active-line:before, body.showEditorSelection li.code-line:hover:before { left: -30px; } .vscode-light.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(0, 0, 0, 0.15); } .vscode-light.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(0, 0, 0, 0.40); } .vscode-light.showEditorSelection .code-line .code-line:hover:before { border-left: none; } .vscode-dark.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 255, 255, 0.4); } .vscode-dark.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 255, 255, 0.60); } .vscode-dark.showEditorSelection .code-line .code-line:hover:before { border-left: none; } .vscode-high-contrast.showEditorSelection .code-active-line:before { border-left: 3px solid rgba(255, 160, 0, 0.7); } .vscode-high-contrast.showEditorSelection .code-line:hover:before { border-left: 3px solid rgba(255, 160, 0, 1); } .vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before { border-left: none; } img { max-width: 100%; max-height: 100%; } a { text-decoration: none; } a:hover { text-decoration: underline; } a:focus, input:focus, select:focus, textarea:focus { outline: 1px solid -webkit-focus-ring-color; outline-offset: -1px; } hr { border: 0; height: 2px; border-bottom: 2px solid; } h1 { padding-bottom: 0.3em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; } h1, h2, h3 { font-weight: normal; } h1 code, h2 code, h3 code, h4 code, h5 code, h6 code { font-size: inherit; line-height: auto; } table { border-collapse: collapse; } table > thead > tr > th { text-align: left; border-bottom: 1px solid; } table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td { padding: 5px 10px; } table > tbody > tr + tr > td { border-top: 1px solid; } blockquote { margin: 0 7px 0 5px; padding: 0 16px 0 10px; border-left-width: 5px; border-left-style: solid; } code { font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback"; font-size: 14px; line-height: 19px; } body.wordWrap pre { white-space: pre-wrap; } .mac code { font-size: 12px; line-height: 18px; } pre:not(.hljs), pre.hljs code > div { padding: 16px; border-radius: 3px; overflow: auto; } /** Theming */ pre code { color: var(--vscode-editor-foreground); } .vscode-light pre { background-color: rgba(220, 220, 220, 0.4); } .vscode-dark pre { background-color: rgba(10, 10, 10, 0.4); } .vscode-high-contrast pre { background-color: rgb(0, 0, 0); } .vscode-high-contrast h1 { border-color: rgb(0, 0, 0); } .vscode-light table > thead > tr > th { border-color: rgba(0, 0, 0, 0.69); } .vscode-dark table > thead > tr > th { border-color: rgba(255, 255, 255, 0.69); } .vscode-light h1, .vscode-light hr, .vscode-light table > tbody > tr + tr > td { border-color: rgba(0, 0, 0, 0.18); } .vscode-dark h1, .vscode-dark hr, .vscode-dark table > tbody > tr + tr > td { border-color: rgba(255, 255, 255, 0.18); } 
</style>
<style>
/* https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/styles/vs2015.css */ /* * Visual Studio 2015 dark style * Author: Nicolas LLOBERA <nllobera@gmail.com> */ .hljs-keyword, .hljs-literal, .hljs-symbol, .hljs-name { color: #569CD6; } .hljs-link { color: #569CD6; text-decoration: underline; } .hljs-built_in, .hljs-type { color: #4EC9B0; } .hljs-number, .hljs-class { color: #B8D7A3; } .hljs-string, .hljs-meta-string { color: #D69D85; } .hljs-regexp, .hljs-template-tag { color: #9A5334; } .hljs-subst, .hljs-function, .hljs-title, .hljs-params, .hljs-formula { color: #DCDCDC; } .hljs-comment, .hljs-quote { color: #57A64A; font-style: italic; } .hljs-doctag { color: #608B4E; } .hljs-meta, .hljs-meta-keyword, .hljs-tag { color: #9B9B9B; } .hljs-variable, .hljs-template-variable { color: #BD63C5; } .hljs-attr, .hljs-attribute, .hljs-builtin-name { color: #9CDCFE; } .hljs-section { color: gold; } .hljs-emphasis { font-style: italic; } .hljs-strong { font-weight: bold; } /*.hljs-code { font-family:'Monospace'; }*/ .hljs-bullet, .hljs-selector-tag, .hljs-selector-id, .hljs-selector-class, .hljs-selector-attr, .hljs-selector-pseudo { color: #D7BA7D; } .hljs-addition { background-color: #144212; display: inline-block; width: 100%; } .hljs-deletion { background-color: #600; display: inline-block; width: 100%; } /* From https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/styles/vs.css */ /* Visual Studio-like style based on original C# coloring by Jason Diamond <jason@diamond.name> */ .vscode-light .hljs-function, .vscode-light .hljs-params { color: inherit; } .vscode-light .hljs-comment, .vscode-light .hljs-quote, .vscode-light .hljs-variable { color: #008000; } .vscode-light .hljs-keyword, .vscode-light .hljs-selector-tag, .vscode-light .hljs-built_in, .vscode-light .hljs-name, .vscode-light .hljs-tag { color: #00f; } .vscode-light .hljs-string, .vscode-light .hljs-title, .vscode-light .hljs-section, .vscode-light .hljs-attribute, .vscode-light .hljs-literal, .vscode-light .hljs-template-tag, .vscode-light .hljs-template-variable, .vscode-light .hljs-type, .vscode-light .hljs-addition { color: #a31515; } .vscode-light .hljs-deletion, .vscode-light .hljs-selector-attr, .vscode-light .hljs-selector-pseudo, .vscode-light .hljs-meta { color: #2b91af; } .vscode-light .hljs-doctag { color: #808080; } .vscode-light .hljs-attr { color: #f00; } .vscode-light .hljs-symbol, .vscode-light .hljs-bullet, .vscode-light .hljs-link { color: #00b0e8; } .vscode-light .hljs-emphasis { font-style: italic; } .vscode-light .hljs-strong { font-weight: bold; }
</style>
<style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'HelveticaNeue-Light', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
    </head>
    <body>
        <h1 id="lab8---范围搜索实验">Lab8 - 范围搜索实验</h1>
<h2 id="1-实验要求">1. 实验要求</h2>
<p>　　本次实验你将基于BST扩展order table 的ADT接口，完成一些基本函数，你可以从一般的库函数出发扩展此库。此外，你将完成一个范围搜索实验，即给定一个二维点集，以及一个矩形（用左上和右下坐标表示）范围，找出在此范围内点的个数，你需要自定义数据结构以满足复杂度需求。</p>
<h2 id="2-回答问题">2. 回答问题</h2>
<h3 id="21-完成函数firstlast简述思路">2.1 完成函数first，last简述思路</h3>
<ul>
<li><em>Task 4.1 (6%)</em>. Implement the functions
<ul>
<li><code>fun first (T : 'a table) : (key * 'a) option</code></li>
<li><code>fun last (T : 'a table) : (key * 'a) option</code></li>
<li>Given an ordered table <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span>, <code>first T</code> should evaluate to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi><mtext> </mtext><mo>(</mo><mi>k</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">SOME\ (k,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo>(</mo><mi>k</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">{(k,v)}\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> and k is the minimum key in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span>. Analagously, <code>last T</code> should evaluate to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi><mtext> </mtext><mo>(</mo><mi>k</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">SOME\ (k,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo>(</mo><mi>k</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">{(k,v)}\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> is the maximum key in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span>. Otherwise, they evaluate to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>O</mi><mi>N</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">NONE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span>.</li>
</ul>
</li>
</ul>
<h4 id="211-算法思路">2.1.1 算法思路</h4>
<ol>
<li>判断树是否为空，若为空则直接返回<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>O</mi><mi>N</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">NONE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span></li>
<li>对<code>first</code>而言：判断左子树是否为空
<ol>
<li>若是则表明已经没有比当前节点的优先级小的节点了，返回当前节点的键</li>
<li>若否则表明原树中优先级最小的节点与其左子树中优先级最小的节点相同，于是更新输入树为其左子树</li>
</ol>
</li>
<li>对<code>last</code>同理，将左/右，大/小互换即可</li>
</ol>
<h4 id="212-代码实现">2.1.2 代码实现</h4>
<pre><code class="language-SML"><div><span class="hljs-keyword">fun</span> first (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table) : (key * <span class="hljs-symbol">'a</span>) <span class="hljs-built_in">option</span> =
        <span class="hljs-keyword">case</span> <span class="hljs-type">Tree</span>.expose <span class="hljs-type">T</span>
        <span class="hljs-keyword">of</span> <span class="hljs-type">NONE</span> =&gt; <span class="hljs-type">NONE</span>
        | <span class="hljs-type">SOME</span> {key=k, value=v, left=l, right=r} =&gt;
            <span class="hljs-keyword">if</span> <span class="hljs-type">Tree</span>.size l = <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-type">SOME</span> (k, v) <span class="hljs-keyword">else</span> first l

<span class="hljs-keyword">fun</span> last (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table) : (key * <span class="hljs-symbol">'a</span>) <span class="hljs-built_in">option</span> =
        <span class="hljs-keyword">case</span> <span class="hljs-type">Tree</span>.expose <span class="hljs-type">T</span>
        <span class="hljs-keyword">of</span> <span class="hljs-type">NONE</span> =&gt; <span class="hljs-type">NONE</span>
        | <span class="hljs-type">SOME</span> {key=k, value=v, left=l, right=r} =&gt;
            <span class="hljs-keyword">if</span> <span class="hljs-type">Tree</span>.size r = <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-type">SOME</span> (k, v) <span class="hljs-keyword">else</span> last r
</div></code></pre>
<h4 id="213-关于测试">2.1.3 关于测试</h4>
<ol>
<li>测试任意多元素集（乱序排列，首/尾项不在对应首/尾位置）</li>
<li>测试空集是否能返回正确结果</li>
</ol>
<h3 id="22-完成函数previous和next并简述思路">2.2 完成函数previous和next并简述思路</h3>
<ul>
<li><em>Task 4.2 (8%)</em>. Implement the functions
<ul>
<li><code>fun previous (T : 'a table) (k : key) : (key * 'a) option</code></li>
<li><code>fun next (T : 'a table) (k : key) : (key * 'a) option</code></li>
<li>Given an ordered table <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span> and a key <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>, <code>previous T k</code> should evaluate to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi><mo>(</mo><msup><mi>k</mi><mo mathvariant="normal">′</mo></msup><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">SOME (k&#x27;,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo>(</mo><msub><mi>k</mi><mn>0</mn></msub><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">{(k_0,v)}\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>k</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">k_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the greatest key in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span> strictly less than <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>. Otherwise, it evaluates to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>O</mi><mi>N</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">NONE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span>. Similarly, <code>next T k</code> should evaluate to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi><mtext> </mtext><mo>(</mo><msup><mi>k</mi><mo mathvariant="normal">′</mo></msup><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">SOME\ (k&#x27;,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> iff <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>k</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">k_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the least key in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span> strictly greater than <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>.</li>
</ul>
</li>
</ul>
<h4 id="221-算法思路">2.2.1 算法思路</h4>
<ol>
<li><code>previous</code>是要求绝对小于所给key的优先级的元素中最大的那一个，恰能用上面完成的<code>last</code>函数结合库函数中的<code>splitAt</code>实现</li>
<li><code>next</code>同理</li>
<li>自己尝试实现了一个<code>previous</code>，但是只能放在库函数里使用，因为提交部分中，<code>NODE</code>操作没有被载入</li>
</ol>
<h4 id="222-代码实现">2.2.2 代码实现</h4>
<pre><code class="language-SML"><div>
<span class="hljs-keyword">fun</span> next (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table) (k : key) : (key * <span class="hljs-symbol">'a</span>) <span class="hljs-built_in">option</span> = first (#<span class="hljs-number">3</span> (<span class="hljs-type">Tree</span>.splitAt (<span class="hljs-type">T</span>, k)))

<span class="hljs-keyword">fun</span> previous (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table) (k : key) : (key * <span class="hljs-symbol">'a</span>) <span class="hljs-built_in">option</span> = last (#<span class="hljs-number">1</span> (<span class="hljs-type">Tree</span>.splitAt (<span class="hljs-type">T</span>, k)))

<span class="hljs-comment">(* 下面是自己尝试的一个更节省的实现，但是因为待完成的函子内部不能使用NODE操作，没法在要提交的代码里使用 *)</span>
<span class="hljs-keyword">fun</span> previous (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table) (k : key) : (key * <span class="hljs-symbol">'a</span>) <span class="hljs-built_in">option</span> =
  <span class="hljs-keyword">let</span>
    <span class="hljs-keyword">fun</span> chk (<span class="hljs-type">EMPTY</span>, _, _) = <span class="hljs-type">NONE</span>
      | chk (<span class="hljs-type">NODE</span> {data=d, left=l, right=r, ...}, <span class="hljs-type">SOME</span> p, stats) =
        <span class="hljs-keyword">case</span> <span class="hljs-type">Key</span>.compare (k, #key d)
          <span class="hljs-keyword">of</span> <span class="hljs-type">EQUAL</span> =&gt; <span class="hljs-keyword">if</span> l = <span class="hljs-type">EMPTY</span> <span class="hljs-keyword">then</span> <span class="hljs-type">NONE</span> <span class="hljs-keyword">else</span> <span class="hljs-type">SOME</span> (#key (#data l), #value (#data l))
            | <span class="hljs-type">LESS</span> =&gt; <span class="hljs-keyword">if</span> stats = <span class="hljs-type">GREATER</span> <span class="hljs-keyword">then</span> <span class="hljs-type">SOME</span> p <span class="hljs-keyword">else</span> chk (l, <span class="hljs-type">SOME</span> (#key d, #value d), <span class="hljs-type">LESS</span>)
            | <span class="hljs-type">GREATER</span> =&gt; <span class="hljs-keyword">if</span> stats = <span class="hljs-type">LESS</span> <span class="hljs-keyword">then</span> <span class="hljs-type">SOME</span> (#key d, #value d) <span class="hljs-keyword">else</span> chk (r, <span class="hljs-type">SOME</span> (#key d, #value d), <span class="hljs-type">GREATER</span>)
  <span class="hljs-keyword">in</span>
    chk (<span class="hljs-type">T</span>, <span class="hljs-type">NONE</span>, <span class="hljs-type">EQUAL</span>)
  <span class="hljs-keyword">end</span>

</div></code></pre>
<h4 id="223-关于测试">2.2.3 关于测试</h4>
<ol>
<li>测试<code>k</code>为任意多元素集的非首尾元素时能否给出正确结果（乱序排列，首/尾项不在对应首/尾位置）</li>
<li>测试<code>k</code>为任意多元素集的首/尾元素时能否给出正确结果<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>O</mi><mi>N</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">NONE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span></li>
<li>测试空集是否能返回正确结果<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>O</mi><mi>N</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">NONE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span></li>
</ol>
<h3 id="23-完成下列函数做必要说明">2.3 完成下列函数，做必要说明</h3>
<ul>
<li>
<p><em>Task 4.3 (2%)</em>. Implement the function</p>
<ul>
<li><code>fun join (L : 'a table, R : 'a table) : 'a table</code></li>
<li>Given ordered tables <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">L</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span>, where all the keys in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">L</span></span></span></span> are strictly less than those in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span>, <code>join (L, R)</code> should evaluate to an ordered table containing all the keys from both <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">L</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.00773em;">R</span></span></span></span>.</li>
</ul>
</li>
<li>
<p><em>Task 4.4 (2%)</em>. Implement the function</p>
<ul>
<li><code>fun split (L : 'a table, k : key) : 'a table * 'a option * 'a table</code></li>
<li>Given an ordered table T and a key k, split should evaluate to a triple consisting of
<ol>
<li>an ordered table containing every <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo>(</mo><msup><mi>k</mi><mo mathvariant="normal">′</mo></msup><mo separator="true">,</mo><mtext> </mtext><mi>v</mi><mo>)</mo></mrow><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">{(k&#x27;,\ v)}\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> such that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>k</mi><mo mathvariant="normal">′</mo></msup><mo>&lt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">{k&#x27;}\lt{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.790992em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>O</mi><mi>M</mi><mi>E</mi><mtext> </mtext><mi>v</mi></mrow><annotation encoding="application/x-tex">SOME\ v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mspace"> </span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo>(</mo><mi>k</mi><mo separator="true">,</mo><mtext> </mtext><mi>v</mi><mo>)</mo></mrow><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">{(k,\ v)}\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>O</mi><mi>N</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">NONE</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span> otherwise</li>
<li>an ordered table containing every <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo>(</mo><msup><mi>k</mi><mo mathvariant="normal">′</mo></msup><mo separator="true">,</mo><mtext> </mtext><mi>v</mi><mo>)</mo></mrow><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">{(k&#x27;,\ v)}\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.001892em;vertical-align:-0.25em;"></span><span class="mord"><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> such that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>k</mi><mo mathvariant="normal">′</mo></msup><mo>&gt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">{k&#x27;}\gt{k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.790992em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span></span>.</li>
</ol>
</li>
</ul>
</li>
</ul>
<h4 id="231-算法思路">2.3.1 算法思路</h4>
<ol>
<li>库函数中的join与splitAt很显然能满足该题需求</li>
<li>由于上述原因，不再重复实现一遍库函数内容，大致原理与上述previous的自主实现方式相同，需通过额外变量来保存两侧的树结构（库中使用了一个函数变量）</li>
</ol>
<h4 id="232-代码实现">2.3.2 代码实现</h4>
<pre><code class="language-SML"><div>
<span class="hljs-keyword">fun</span> join (<span class="hljs-type">L</span> : <span class="hljs-symbol">'a</span> table, <span class="hljs-type">R</span> : <span class="hljs-symbol">'a</span> table) : <span class="hljs-symbol">'a</span> table = <span class="hljs-type">Tree</span>.join(<span class="hljs-type">L</span>, <span class="hljs-type">R</span>)

<span class="hljs-keyword">fun</span> join ((<span class="hljs-type">EMPTY</span>, t) | (t, <span class="hljs-type">EMPTY</span>)) = t
  | join (nL <span class="hljs-keyword">as</span> <span class="hljs-type">NODE</span> {data=dL, left=lL, right=rL, ...},
          nR <span class="hljs-keyword">as</span> <span class="hljs-type">NODE</span> {data=dR, left=lR, right=rR, ...}) =
    <span class="hljs-keyword">if</span> #pri dL &lt; #pri dR
    <span class="hljs-keyword">then</span> mk (dL, lL, join (rL, nR))
    <span class="hljs-keyword">else</span> mk (dR, join (nL, lR), rR)

<span class="hljs-keyword">fun</span> split (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table, k : key) : <span class="hljs-symbol">'a</span> table * <span class="hljs-symbol">'a</span> <span class="hljs-built_in">option</span> * <span class="hljs-symbol">'a</span> table = <span class="hljs-type">Tree</span>.splitAt (<span class="hljs-type">T</span>, k)

<span class="hljs-comment">(* MkTreap.sml *)</span>
<span class="hljs-keyword">fun</span> splitAt (t, k) =
    <span class="hljs-keyword">let</span>
      <span class="hljs-keyword">fun</span> spl <span class="hljs-type">EMPTY</span> f = f (<span class="hljs-type">EMPTY</span>, <span class="hljs-type">NONE</span>, <span class="hljs-type">EMPTY</span>)
        | spl (<span class="hljs-type">NODE</span> {data=d, left=l, right=r, ...}) f =
          <span class="hljs-keyword">case</span> <span class="hljs-type">HashKey</span>.compare (k, #key d)
            <span class="hljs-keyword">of</span> <span class="hljs-type">EQUAL</span> =&gt; f (l, <span class="hljs-type">SOME</span> (#value d), r)
             | <span class="hljs-type">LESS</span> =&gt; spl l (<span class="hljs-keyword">fn</span> (<span class="hljs-type">L</span>, <span class="hljs-type">M</span>, <span class="hljs-type">R</span>) =&gt; f (<span class="hljs-type">L</span>, <span class="hljs-type">M</span>, mk (d, <span class="hljs-type">R</span>, r)))
             | <span class="hljs-type">GREATER</span> =&gt; spl r (<span class="hljs-keyword">fn</span> (<span class="hljs-type">L</span>, <span class="hljs-type">M</span>, <span class="hljs-type">R</span>) =&gt; f (mk (d, l, <span class="hljs-type">L</span>), <span class="hljs-type">M</span>, <span class="hljs-type">R</span>))
    <span class="hljs-keyword">in</span>
      spl t (<span class="hljs-keyword">fn</span> x =&gt; x)
    <span class="hljs-keyword">end</span>

</div></code></pre>
<h4 id="233-关于测试">2.3.3 关于测试</h4>
<ol>
<li>测试从树中有的节点切割，返回左右子树均不包含切割节点</li>
<li>测试从树中没有的节点切割，返回正确的左右子树</li>
<li>测试从边界以外切割，空子树能否正确返回</li>
</ol>
<h3 id="24-完成函数getrange并详述思路">2.4 完成函数getRange并详述思路</h3>
<ul>
<li><em>Task 4.5 (7%)</em>. Implement the function
<ul>
<li><code>fun getRange (T : 'a table) (low : key, high : key) : 'a table</code></li>
<li>Given an ordered table <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span> and keys <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi></mrow><annotation encoding="application/x-tex">l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.01968em;">l</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit">h</span></span></span></span>, <code>getRange T (l, h)</code> should evaluate to an ordered table containing every <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>k</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo><mo>∈</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">(k,v)\in{T}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span></span> such that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>l</mi><mo>≤</mo><mi>k</mi><mo>≤</mo><mi>h</mi></mrow><annotation encoding="application/x-tex">{l}\le{k}\le{h}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.01968em;">l</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83041em;vertical-align:-0.13597em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit">h</span></span></span></span></span>.</li>
</ul>
</li>
</ul>
<h4 id="241-算法思路">2.4.1 算法思路</h4>
<ol>
<li>split函数可以进行切割，因此进行两次切割后可以切出一个满足指定边界的开区间</li>
<li>由于要求进行闭区间搜索，需在切割后判断切割点是否在原树中，若是则需在结果中加入该点</li>
</ol>
<h4 id="242-代码实现">2.4.2 代码实现</h4>
<pre><code class="language-SML"><div>
<span class="hljs-keyword">fun</span> getRange (<span class="hljs-type">T</span> : <span class="hljs-symbol">'a</span> table) (low : key, high : key) : <span class="hljs-symbol">'a</span> table =
    <span class="hljs-keyword">case</span> (<span class="hljs-type">Table</span>.find <span class="hljs-type">T</span> low, <span class="hljs-type">Table</span>.find <span class="hljs-type">T</span> high)
      <span class="hljs-keyword">of</span> (<span class="hljs-type">NONE</span>, <span class="hljs-type">NONE</span>) =&gt; #<span class="hljs-number">1</span> (split (#<span class="hljs-number">3</span> (split (<span class="hljs-type">T</span>, low)), high))
       | (<span class="hljs-type">SOME</span> lv, <span class="hljs-type">NONE</span>) =&gt; #<span class="hljs-number">1</span> (split (join (<span class="hljs-type">Tree</span>.singleton(low, lv), #<span class="hljs-number">3</span> (split (<span class="hljs-type">T</span>, low))), high))
       | (<span class="hljs-type">NONE</span>, <span class="hljs-type">SOME</span> hv) =&gt; join (#<span class="hljs-number">1</span> (split (#<span class="hljs-number">3</span> (split (<span class="hljs-type">T</span>, low)), high)), <span class="hljs-type">Tree</span>.singleton (high, hv))
       | (<span class="hljs-type">SOME</span> lv, <span class="hljs-type">SOME</span> hv) =&gt; join (#<span class="hljs-number">1</span> (split (join (<span class="hljs-type">Tree</span>.singleton (low, lv), #<span class="hljs-number">3</span> (split (<span class="hljs-type">T</span>, low))), high)), <span class="hljs-type">Tree</span>.singleton(high, hv))

</div></code></pre>
<h4 id="243-关于测试">2.4.3 关于测试</h4>
<ol>
<li>测试切割点在原树中存在的情况</li>
<li>测试切割点在树中不存在但指定区间不包含树的所有节点的情况</li>
<li>测试指定区间包含了树的所有节点的情况</li>
<li>测试空树</li>
<li>测试单元素树</li>
</ol>
<h3 id="25-完成函数makecounttable并回答相关问题">2.5 完成函数makeCountTable并回答相关问题</h3>
<ul>
<li>
<p><em>Task 5.1 (25%)</em>. In the <code>MkRangeQuery</code> functor, deﬁne the <code>countTable</code> type and implement the function</p>
<ul>
<li><code>fun makeCountTable: point seq -&gt; countTable</code></li>
<li>The type point is deﬁned to be <code>OrdTable.Key.t * OrdTable.Key.t</code> where <code>OrdTable</code> is an ordered table structure provided to you. You should choose the type of countTable such that you can implement <code>count (range queries)</code> in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span> work and span. For full credit, your <code>makeCountTable</code> must run within <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span>expected work.</li>
</ul>
</li>
<li>
<p><em>Task 5.2 (10%)</em>. Brieﬂy describe how you would parallelize your code so that it runs in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>log</mi><mo>⁡</mo><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log^{2}{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span> span. Does the work remain the same? You don’t need to formally prove the bounds, just brieﬂy justify them.</p>
</li>
<li>
<p><em>Task 5.3 (5%)</em>. What is the expected space complexity of your <code>countTable</code> in terms of n the number of input points? That is, how many nodes in the underlying binary search tree(s) does your countTable use in expectation? Explain in a few short sentences.</p>
</li>
</ul>
<h4 id="251-算法思路">2.5.1 算法思路</h4>
<ol>
<li>countTable做成二级Table，一级保存X值，一级保存Y值，便可以方便地依次排除两个方向上不在区域内的点</li>
<li>根据提示，通过牺牲空间，每个横坐标的键保存大于等于它的所有横坐标上的点，可以通过简单的减法计算实现搜索时的时间加速</li>
<li>先对X轴进行排序，使得每个X坐标上的点在比其大的X坐标处复制一份，从而制出满足要求的，以每个X坐标为键的有序Table，再对每个X坐标键对应的点集以Y坐标为键制成有序Table</li>
<li>本题代码主要长度来源于格式修改操作，以保证最终能得到没有多余级别的二级Table，核心代码较短，为seqwithkeys变量的赋值操作，进行空间上的复制从而节省搜索的耗时</li>
</ol>
<h4 id="252-代码实现">2.5.2 代码实现</h4>
<pre><code class="language-SML"><div>  <span class="hljs-keyword">type</span> countTable = point seq table table

  <span class="hljs-keyword">fun</span> makeCountTable (<span class="hljs-type">S</span> : point seq) : countTable =
    <span class="hljs-keyword">case</span> <span class="hljs-type">Seq</span>.length <span class="hljs-type">S</span>
      <span class="hljs-keyword">of</span> <span class="hljs-number">0</span> =&gt; empty<span class="hljs-literal">()</span>
       | _ =&gt;
          <span class="hljs-keyword">let</span>
            <span class="hljs-comment">(* W: nlgn, S: lg^2n *)</span>
            <span class="hljs-keyword">val</span> sorted = <span class="hljs-type">Seq</span>.sort (<span class="hljs-keyword">fn</span> ((x1, _), (x2, _)) =&gt; <span class="hljs-type">Key</span>.compare (x1, x2)) <span class="hljs-type">S</span>
            <span class="hljs-comment">(* S: 1, W: n *)</span>
            <span class="hljs-keyword">val</span> withkeys = <span class="hljs-type">Seq</span>.map (<span class="hljs-keyword">fn</span> (x,y) =&gt; (x, (x, y))) <span class="hljs-type">S</span>
            <span class="hljs-keyword">val</span> keyTable = (<span class="hljs-type">OrdTable</span>.collect withkeys)
            <span class="hljs-keyword">val</span> keys = <span class="hljs-type">Set</span>.toSeq (<span class="hljs-type">OrdTable</span>.domain keyTable)
            <span class="hljs-comment">(* S： lg^2n, W: nlgn *)</span>
            <span class="hljs-keyword">val</span> seqwithkeys = <span class="hljs-type">Seq</span>.sort (<span class="hljs-keyword">fn</span> ((x1, _),(x2,_)) =&gt; <span class="hljs-type">Key</span>.compare (x1, x2)) (<span class="hljs-type">Seq</span>.tabulate (<span class="hljs-keyword">fn</span> i =&gt; <span class="hljs-keyword">let</span> <span class="hljs-keyword">val</span> (x, s) = (<span class="hljs-type">Seq</span>.nth keys i, valOf(<span class="hljs-type">OrdTable</span>.find keyTable (<span class="hljs-type">Seq</span>.nth keys i))) <span class="hljs-keyword">in</span> (x, s) <span class="hljs-keyword">end</span>) (<span class="hljs-type">OrdTable</span>.size keyTable))
            <span class="hljs-keyword">fun</span> generateOne (m) =
              <span class="hljs-keyword">let</span>
                <span class="hljs-keyword">val</span> (x, s) = <span class="hljs-type">Seq</span>.nth seqwithkeys m
              <span class="hljs-keyword">in</span>
                <span class="hljs-type">Seq</span>.tabulate (<span class="hljs-keyword">fn</span> i =&gt; (#<span class="hljs-number">1</span> (<span class="hljs-type">Seq</span>.nth seqwithkeys i), s)) (m+<span class="hljs-number">1</span>)
              <span class="hljs-keyword">end</span>
            <span class="hljs-keyword">val</span> xtableraw = <span class="hljs-type">Seq</span>.flatten (<span class="hljs-type">Seq</span>.tabulate (<span class="hljs-keyword">fn</span> n =&gt; generateOne n) (<span class="hljs-type">OrdTable</span>.size keyTable))
            <span class="hljs-keyword">val</span> xtable = <span class="hljs-type">OrdTable</span>.collect xtableraw
            <span class="hljs-keyword">val</span> redundent = <span class="hljs-type">OrdTable</span>.map (<span class="hljs-keyword">fn</span> t =&gt; <span class="hljs-type">Seq</span>.map (<span class="hljs-keyword">fn</span> (x,y) =&gt; (y, (x,y))) (<span class="hljs-type">Seq</span>.flatten t)) xtable
          <span class="hljs-keyword">in</span>
            <span class="hljs-type">OrdTable</span>.map (<span class="hljs-keyword">fn</span> t =&gt; <span class="hljs-type">OrdTable</span>.collect t) redundent
          <span class="hljs-keyword">end</span>

</div></code></pre>
<h4 id="253-关于测试">2.5.3 关于测试</h4>
<ul>
<li>本题测试在2.6.3中完成</li>
</ul>
<h4 id="254-task-52">2.5.4 Task 5.2</h4>
<ul>
<li>待并行部分为Work与Span相差较大且Work与Span本身较大的部分，已于注释中标出
<ul>
<li><code>sorted</code>：对X坐标排序以进行后续复制操作，并行后<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>S</mi><mi>p</mi><mi>a</mi><mi>n</mi></mrow><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>log</mi><mo>⁡</mo><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">{Span}\in{\mathcal{O}(\log^{2}{n})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">n</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></span></li>
<li><code>seqwithkeys</code>：主要步骤，调用span较低的<code>tabulate</code>、<code>find</code>、<code>size</code>等库函数进行各点依X坐标大小的复制，主要span来源于sort的快速排序，并行后<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>S</mi><mi>p</mi><mi>a</mi><mi>n</mi></mrow><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>log</mi><mo>⁡</mo><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">{Span}\in{\mathcal{O}(\log^{2}{n})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">n</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></span></li>
<li><code>withkeys</code>：该变量的赋值用到map操作，Work较高，但<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">Span\in{\mathcal{O}(1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></li>
<li>其余用到Tabulate之类的Work高但<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">Span\in{\mathcal{O}(1)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>的操作</li>
</ul>
</li>
<li>综上，总Span为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>log</mi><mo>⁡</mo><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log^{2}{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span>，显然这些并行操作只是将同样的工作分给多个处理器进行，不会改变总工作量，即work不变</li>
</ul>
<h4 id="255-task-53-空间复杂度计算">2.5.5 Task 5.3 (空间复杂度计算)</h4>
<ol>
<li><code>sorted+withkeys+keyTable</code>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></li>
<li><code>seqwithkeys</code>:
<ol>
<li>复制每个X坐标上的所有点到比该坐标大的X坐标上，最坏情况假设点的分布是稀疏的，|x| = |y| = n</li>
</ol>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>S</mi><mn>1</mn></msub><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo>(</mo><mi>n</mi><mo>−</mo><mi>i</mi><mo>)</mo></mrow><mo>)</mo></mrow><mo>=</mo><mi mathvariant="script">O</mi><mo>(</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>i</mi><mo>)</mo><mo>=</mo><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">S_1 \in {\mathcal{O}(\sum_{i=1}^{n}{(n-i)})} = \mathcal{O}(\sum_{i=1}^{n}{i}) = \mathcal{O}(n^2)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathit">i</span><span class="mclose">)</span></span><span class="mclose">)</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.929066em;vertical-align:-1.277669em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6513970000000002em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">i</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<ol start="2">
<li>对<code>1</code>中所得的串的每个元素依据其<code>#1</code>进行排序，快排空间复杂度最坏为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>m</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(m)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">m</span><span class="mclose">)</span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi><mo>=</mo><msub><mi>S</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">m = S_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">m</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>故<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">S \in {\mathcal{O}(n^2)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li>
</ol>
</li>
<li><code>xtableraw+xtable+redundent</code>: <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>s</mi><mi>e</mi><mi>q</mi><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>k</mi><mi>e</mi><mi>y</mi><mi>s</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(seqwithkeys)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">s</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">q</span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mord mathit">i</span><span class="mord mathit">t</span><span class="mord mathit">h</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mord mathit">s</span><span class="mclose">)</span></span></span></span></li>
<li>综上，空间复杂度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
</ol>
<h4 id="254-时间复杂度计算检查代码留的题">2.5.4 时间复杂度计算（检查代码留的题）</h4>
<ol>
<li>Span：由2.5.2可知，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><msup><mi>log</mi><mo>⁡</mo><mn>2</mn></msup><mi>n</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">Span\in{\mathcal{O}(\log^{2}{n})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.05764em;">S</span><span class="mord mathit">p</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.148448em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></span></li>
<li>Work：
<ul>
<li><code>sorted</code>：快排，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi></mrow><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">{Work}\in{\mathcal{O}(n\log{n})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></span></li>
<li><code>seqwithkeys</code>：各点依X坐标大小进行复制操作，先进行<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi></mrow><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">{Work}\in{\mathcal{O}(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></span>的tabulate，后进行sort，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi></mrow><mo>∈</mo><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow></mrow><annotation encoding="application/x-tex">{Work}\in{\mathcal{O}(n\log{n})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.13889em;">W</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></span></li>
<li>综上，总Work为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(n\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></li>
</ul>
</li>
</ol>
<h4 id="255-flatten的复杂度计算检查代码留的题">2.5.5 flatten的复杂度计算（检查代码留的题）</h4>
<ol>
<li>记有<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">∣</mi><mi>a</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|a|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathit">a</span><span class="mord">∣</span></span></span></span>个串, 每个串<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>a</mi></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">|x_a|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span>个元素</li>
<li>Work：由于flatten表示将所有的串合并为一个，因此其Work相当于append作用于X个串，总工作量为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">W</mi><mo>(</mo><mi>f</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mo>)</mo><mtext> </mtext><mo>=</mo><mi mathvariant="normal">∣</mi><mi>a</mi><mi mathvariant="normal">∣</mi><mo>∗</mo><mi mathvariant="script">W</mi><mo>(</mo><mi>a</mi><mi>p</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>d</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}(flatten)\ = |a|*\mathcal{W}(append)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace"> </span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathit">a</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord mathit">a</span><span class="mord mathit">p</span><span class="mord mathit">p</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">d</span><span class="mclose">)</span></span></span></span>, 在ArraySeq与ListSeq下为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>+</mo><mi mathvariant="normal">∣</mi><mi>a</mi><mi mathvariant="normal">∣</mi><mo>+</mo><msub><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>a</mi></mrow></msub><mrow><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>a</mi></msub><mi mathvariant="normal">∣</mi></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1+|a|+\sum_{{x}\in{a}}{|x_a|})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathit">a</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.07708em;vertical-align:-0.32708000000000004em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.07765999999999995em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight">x</span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathit mtight">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.32708000000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span><span class="mclose">)</span></span></span></span>, 在TreeSeq下, 以<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><msub><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>a</mi></mrow></msub><mrow><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>a</mi></msub><mi mathvariant="normal">∣</mi></mrow><mo>)</mo></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log{(\sum_{{x}\in{a}}{|x_a|})})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.07708em;vertical-align:-0.32708000000000004em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen">(</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.07765999999999995em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight">x</span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathit mtight">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.32708000000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span><span class="mclose">)</span></span><span class="mclose">)</span></span></span></span>为单次最坏复杂度，则Work为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>+</mo><mi mathvariant="normal">∣</mi><mi>a</mi><mi mathvariant="normal">∣</mi><mo>∗</mo><mi>log</mi><mo>⁡</mo><mrow><mo>(</mo><msub><mo>∑</mo><mrow><mi>x</mi><mo>∈</mo><mi>a</mi></mrow></msub><mrow><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>a</mi></msub><mi mathvariant="normal">∣</mi></mrow><mo>)</mo></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1+|a|*\log{(\sum_{{x}\in{a}}{|x_a|})})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathit">a</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.07708em;vertical-align:-0.32708000000000004em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen">(</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.07765999999999995em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight">x</span></span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mathit mtight">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.32708000000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span></span><span class="mclose">)</span></span><span class="mclose">)</span></span></span></span></li>
<li>Span：以ArraySeq为例，计算每个串将被写入到的新串中的位置需要用到<code>scan</code>，而写入是完全并行的，复杂度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>,因此总复杂度与<code>scan</code>相同，为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mn>1</mn><mo>+</mo><mi>log</mi><mo>⁡</mo><mrow><mi mathvariant="normal">∣</mi><mi>a</mi><mi mathvariant="normal">∣</mi></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(1+\log{|a|})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord">∣</span><span class="mord mathit">a</span><span class="mord">∣</span></span><span class="mclose">)</span></span></span></span></li>
</ol>
<h3 id="26-完成函数count并做相关分析">2.6 完成函数count并做相关分析</h3>
<ul>
<li><em>Task 5.4 (25%)</em>. Implement the function
<ul>
<li>count: countTable -&gt; point * point -&gt; int</li>
<li>As described earlier, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>T</mi><mtext> </mtext><mo>(</mo><mo>(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>y</mi><mn>1</mn></msub><mo>)</mo><mo separator="true">,</mo><mtext> </mtext><mo>(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>y</mi><mn>2</mn></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">count\ T\ ((x_1,\ y_1),\ (x_2,\ y_2))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">c</span><span class="mord mathit">o</span><span class="mord mathit">u</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mspace"> </span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mspace"> </span><span class="mopen">(</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> will report the umber of points within the rectangle with the top-left corner (x1, y1) and bottom-right corner <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mtext> </mtext><msub><mi>y</mi><mn>2</mn></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">(x_2,\ y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mspace"> </span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>. Your function should return the number of points within and on the boundary of the rectangle. You may ﬁnd the <code>OrdTable.size</code> function useful here. Your implementation should have <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span> work and span.</li>
</ul>
</li>
</ul>
<h4 id="261-算法思路">2.6.1 算法思路</h4>
<ol>
<li>由于上述countTable的结构为二级Table，第一级Table的某一个键表示一个X坐标，其所对应的值表示大于等于该X坐标的所有点以Y坐标为键组成的Table</li>
<li>因此，根据题目提示知，要找区域内的点的数目，只需要先求出较小X坐标右侧（包含该坐标）所有Y值满足要求的点（用<code>getRange</code>求Y值满足条件的点），再求出较大X坐标右侧（不包含该坐标）的所有Y值满足要求的点，二者相减即为所求</li>
<li>函数中用到的map与reduce并不是针对所有点进行的,而是针对range进行的，有着与OrdTable.range同样的work</li>
<li>由于仅需进行<code>getRange</code>、<code>find</code>、<code>reduce</code>、<code>range</code>等操作，work与span都为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="script">O</mi><mo>(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{O}(\log{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathcal" style="margin-right:0.02778em;">O</span></span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span></span><span class="mclose">)</span></span></span></span></li>
</ol>
<h4 id="262-代码实现">2.6.2 代码实现</h4>
<pre><code class="language-SML"><div>
<span class="hljs-comment">(* Right of (leftbound) - Right of (rightbound) *)</span>
<span class="hljs-keyword">fun</span> count (<span class="hljs-type">T</span> : countTable)
                  ((xLeft, yHi) : point, (xRght, yLo) : point) : <span class="hljs-built_in">int</span>  =
  <span class="hljs-keyword">case</span> <span class="hljs-type">OrdTable</span>.size <span class="hljs-type">T</span>
    <span class="hljs-keyword">of</span> <span class="hljs-number">0</span> =&gt; <span class="hljs-number">0</span>
      | _ =&gt; (<span class="hljs-type">Seq</span>.reduce (<span class="hljs-keyword">fn</span> (a,b) =&gt; a+b) <span class="hljs-number">0</span> (<span class="hljs-type">Seq</span>.map (<span class="hljs-keyword">fn</span> x =&gt; <span class="hljs-type">Seq</span>.length x) (<span class="hljs-type">OrdTable</span>.range (getRange (getOpt(<span class="hljs-type">OrdTable</span>.find <span class="hljs-type">T</span> xLeft, (#<span class="hljs-number">2</span> (getOpt(next <span class="hljs-type">T</span> xLeft, (xLeft, <span class="hljs-type">OrdTable</span>.empty<span class="hljs-literal">()</span>)))))) (yLo, yHi))))) - (<span class="hljs-type">Seq</span>.reduce (<span class="hljs-keyword">fn</span> (a,b) =&gt; a+b) <span class="hljs-number">0</span> (<span class="hljs-type">Seq</span>.map (<span class="hljs-keyword">fn</span> x =&gt; <span class="hljs-type">Seq</span>.length x) (<span class="hljs-type">OrdTable</span>.range (getRange (#<span class="hljs-number">2</span> (getOpt(next <span class="hljs-type">T</span> xRght, (xRght, <span class="hljs-type">OrdTable</span>.empty<span class="hljs-literal">()</span>)))) (yLo, yHi)))))

</div></code></pre>
<h4 id="263-关于测试">2.6.3 关于测试</h4>
<ol>
<li>测试点全在区域内/外的情况</li>
<li>分别测试X/Y边界上有点，区域内有/无点的四种情况</li>
<li>测试边角有点，区域内无点情况</li>
<li>测试根本没有点的情况、只有一个处于上述不同位置的点的情况</li>
</ol>

    </body>
    </html>